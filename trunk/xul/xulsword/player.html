<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!--
    This file is part of Muqaddas Kitob.

    Copyright 2009 John Austin (gpl.programs.info@gmail.com)

    Muqaddas Kitob is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 2 of the License, or
    (at your option) any later version.

    Muqaddas Kitob is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Muqaddas Kitob.  If not, see <http://www.gnu.org/licenses/>.
!-->
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=windows-1250">
  <meta name="generator" content="PSPad editor, www.pspad.com">
  <title>Player</title>
  <link rel="stylesheet" href="chrome://xulsword/skin/style.css" type="text/css">
  
  <script>var UseBibleObjectFrom = "MainWindowBible";</script>
  <script src="chrome://xulsword/content/common0.js" type="text/javascript"></script>
  <script src="chrome://xulsword/content/common1.js" type="text/javascript"></script>
  <script src="chrome://xulsword/content/common2.js" type="text/javascript"></script>

<script type="text/javascript">

var Skp=0;
  
function checkAndEmbedPlayer() {
  var player = MainWindow.Player;
  if (!player || !player.version || !player.book || !player.chapter) {MainWindow.endAudioPlayer(); return;}
  
  var audiofile = MainWindow.getAudioForChapter(player.version, player.book, player.chapter);
  if (!audiofile) {MainWindow.endAudioPlayer(); return;}
  
  jsdump("Have audio file:" + player.book + " " + player.chapter + "\n");
  
  if (MainWindow.checkQuickTime()) {
    embedPlayer(audiofile);
    return;
  }
  else MainWindow.endAudioPlayer();
}


function embedPlayer(audiofile) {
jsdump("Now embedding: File://" + audiofile.path + "\n");
  document.write("<embed name=\"player\" scriptable=\"true\" kioskmode=\"true\" autoplay=\"true\" width=\"210\" height=\"20\" type=\"application/x-mpeg\" src=\"File://" + audiofile.path + "\"></embed>");
}

function checkPlayer() {
//jsdump("Checking player for new chapter\n");
  var player = MainWindow.Player;
  // Skip first 6 calls since player may not be initialized yet
  Skp++; 
  if (Skp >= 7) {
    var myplayer = document.player;
    var remaining = myplayer.GetEndTime() - myplayer.GetTime();
    // If file is done playing, then move to next chapter and begin playing next chapter
    if (remaining < 30) {
      var bkn = findBookNum(player.book);
      var chn = player.chapter;
      if ((bkn!=NumBooks-1)||(chn!=Book[NumBooks-1].numChaps)) {
        Bible.setBiblesReference(player.version, player.book + "." + player.chapter);
        MainWindow.document.getElementById("cmd_xs_nextChapter").doCommand();
        windowLocationReload();
      }
    }
  }
}

</script>

  </head>
  
  <body style="position:relative; top:-4px; left:-6;">
  
  <div id="playerDiv" style="width:210px; height:20px;">
    <script type="text/javascript">if (!window.frameElement.ownerDocument.getElementById("player").hidden) checkAndEmbedPlayer();</script>
  </div>
  
  </body>
</html>
