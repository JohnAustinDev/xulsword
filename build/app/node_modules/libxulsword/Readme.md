# The XulSword Library Node.js Module

This Node.js module provides a JavaScript-based interface to the libxulsword dynamic library. The libxulsword shared object (dll on the Windows platform) should be constructed prior to building this module.

# Linux Build
In Linux, the build depends on libxulsword.so as well as shell tools and environment variables that must be set for each shell. All of this is done by running _source ./init.sh_ from the xulsword project directory. Then the native libxulsword module can be built with _npx electron\_rebuild -f -m ./path/to/libxulsword_. The electron_rebuild module is responsible for compiling against the selected version of Electron.

# Module Testing (out-of-date)
1. while in the napi directory, _npm test_ will run the only regression associated with this module.

# TODOs
1. add licensing information
2. rework the code to utilize the _ObjectWrap_ method of implementing the libxulsword interface
3. serious cleanup of both the _libsword.js_, _xulswordTest.js_, and _libsword_napi.cpp_ files
4. coordinate with team to insure seamless integration of the module

# Windows Build
Although the libxulsword shared library is cross-compiled with MinGW, this module cannot be cross-compiled because node-gyp is not compatible with MinGW. This module must be compiled with MSVC for Windows. However, since it uses node-addon-api, it does not need to be recompiled until the libxulsword shared library's interface changes. For this reason, the MS-Windows libxulsword.node compiled binary is kept under version control. Compilation does not require the libxulsword.dll, but only the libxulsword.def file located in the lib directory. This def file is created by init.sh, and it only changes if libxulsword.dll exported symbols change. When I compiled this module in MS-Windows, I used nvm from https://github.com/coreybutler/nvm-windows.
1. From an admistrator priviledged cmd.exe, the node version and arch to link against must first be selected (ie. _nvm use 16.14.0 32_).
2. From a non-priviledged cmd.exe shell, run either MSVC's _vcvars32.bat_ or _vcvars64.bat_ (the one corresponding to the selected node arch).
3. Run Git/bin/bash.exe from the cmd shell to start a git-bash shell in the new environment.
4. cd into xulsword and update the setenv file so that WINMACHINE=x64 or x86 (whichever corresponds to your chosen node arch).
5. Run _source ./setenv_ to complete the environment settings.
6. Build libxulsword with _npx electron-rebuild -f -m ./path/to/libxulsword_.
7. Commit the resulting lib/$(XCWD)/libxulsword.node binary to version control.
